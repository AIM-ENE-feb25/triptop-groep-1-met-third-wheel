@startuml
title TripTop ApiGateway Authentication Sequence

participant "Client" as client
participant "InboundRequestFilter" as filter
participant "AuthStrategyFactory" as factory
participant "AuthStrategy" as strategy
participant "RestTemplate" as rest

client -> filter: HTTP Request with token

filter -> factory: authStrategy = getStrategy(strategyType)

filter -> strategy: isAuthenticated = isAuthenticated(token)

strategy -> rest: validToken = post

strategy --> filter: authentication result

alt isAuthenticated
    filter --> backend: forward request
else
    filter --> client: return 401 Unauthorized
end

deactivate filter

@enduml